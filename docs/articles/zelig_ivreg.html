<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Instrumental Variable (Two-Stage Least Squares) Regression • Zelig</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">Zelig Project</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/quickstart.html">Quickstart</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/index.html#section-zelig-overview">Zelig Overview</a>
    </li>
    <li>
      <a href="../articles/index.html#section-core-zelig-model-details">Zelig Model Details</a>
    </li>
    <li>
      <a href="../articles/index.html#section-other">Other</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Function Reference
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html#section-main-zelig-workflow">Workflow</a>
    </li>
    <li>
      <a href="../reference/index.html#section-estimation-methods">Estimation Methods</a>
    </li>
    <li>
      <a href="../reference/index.html#section-exterior-interaction-functions">Interacting Outside of Zelig</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    About
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/about.html">Contact/Development Team/Citation</a>
    </li>
    <li>
      <a href="../articles/roadmap.html">Development Roadmap</a>
    </li>
    <li>
      <a href="https://iqss.github.io/rpackagemetrics/">Zelig Adoption Metrics</a>
    </li>
    <li>
      <a href="https://raw.githubusercontent.com/IQSS/Zelig/master/.iqss_reportcard.yml">Statistical Software Devepment Reportcard</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://medium.com/zelig-dev/archive">
    <span class="fa fa-medium"></span>
     
    Dev-Blog
  </a>
</li>
<li>
  <a href="https://twitter.com/zeligproject">
    <span class="fa fa-twitter fa-2x"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/IQSS/Zelig">
    <span class="fa fa-github fa-2x"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Instrumental Variable (Two-Stage Least Squares) Regression</h1>
            
            <h4 class="date">2017-06-22</h4>
          </div>

    
    
<div class="contents">
<p><em>Built using Zelig version 5.1.2.9000</em></p>
<p>Instrumental Variable Regression (via 2 Stage Least Squares) for Continuous Dependent Variables with <code>ivreg</code>.</p>
<p>Instrumental variable regression is used when the correlation between the independent variables and the dependent variable does not reflect the true relationship because the independent variables are correlated with the error term. This can happen because of ommitted variables, reverse causation, and measurement error. Such variables are often referred to as “endogenous” (as opposed to “exogenous” variables that are not correlated with the error term). It may be possible to use instruments–other variables that cause changes in the endogenous variables, but not the dependent variable–to recover the endogenous variabless effects on the independent variable.</p>
<div id="syntax" class="section level2">
<h2 class="hasAnchor">
<a href="#syntax" class="anchor"></a>Syntax</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z.out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/zelig.html">zelig</a></span>(Y ~<span class="st"> </span>X1 +<span class="st"> </span>X2 |<span class="st"> </span>Z1 +<span class="st"> </span>Z2 +<span class="st"> </span>Z3, <span class="dt">model =</span> <span class="st">"ivreg"</span>, <span class="dt">weights =</span> w,
               <span class="dt">data =</span> mydata)
x.out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/setx.html">setx</a></span>(z.out)
s.out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim.html">sim</a></span>(z.out, <span class="dt">x =</span> x.out)</code></pre></div>
<p>Note that <code>|</code> separates the regressors (e.g. <code>X1</code> and <code>X2</code>) from the instruments (e.g. <code>Z1</code>, <code>Z2</code>, <code>Z3</code>). Exogenous regressors have to be included as instruments for themselves.</p>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<p>Load Zelig and other packages used in the example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(Zelig)
<span class="kw">library</span>(dplyr) <span class="co"># for the pipe operator %&gt;%</span></code></pre></div>
<p>Before estimating the model, let’s attach the example data and make some transformations to it. Notably, <code>zivreg</code> does not currently support logging regressors in the <code>zelig</code> call. To get around this, we simply find the logged values before estimating the model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load and transform data</span>
<span class="kw">data</span>(<span class="st">"CigarettesSW"</span>)
CigarettesSW$rprice &lt;-<span class="st"> </span><span class="kw">with</span>(CigarettesSW, price/cpi)
CigarettesSW$rincome &lt;-<span class="st"> </span><span class="kw">with</span>(CigarettesSW, income/population/cpi)
CigarettesSW$tdiff &lt;-<span class="st"> </span><span class="kw">with</span>(CigarettesSW, (taxs -<span class="st"> </span>tax)/cpi)

<span class="co"># log second stage independent variables, as logging internally for ivreg is</span>
<span class="co"># not currently supported</span>
CigarettesSW$log_rprice &lt;-<span class="st"> </span><span class="kw">log</span>(CigarettesSW$rprice)
CigarettesSW$log_rincome &lt;-<span class="st"> </span><span class="kw">log</span>(CigarettesSW$rincome)</code></pre></div>
<p>Now we can estimate the model and summarize the coefficients:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z.out1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/zelig.html">zelig</a></span>(<span class="kw">log</span>(packs) ~<span class="st"> </span>log_rprice +<span class="st"> </span>log_rincome |
<span class="st">                    </span>log_rincome +<span class="st"> </span>tdiff +<span class="st"> </span><span class="kw">I</span>(tax/cpi),
                    <span class="dt">data =</span> CigarettesSW, <span class="dt">subset =</span> year ==<span class="st"> "1995"</span>,
                    <span class="dt">model =</span> <span class="st">"ivreg"</span>)</code></pre></div>
<pre><code>## How to cite this model in Zelig:
##   Christian Kleiber and Achim Zeileis. 2008.
##   ivreg: Instrumental-Variable Regression
##   in Christine Choirat, Christopher Gandrud, James Honaker, Kosuke Imai, Gary King, and Olivia Lau,
##   "Zelig: Everyone's Statistical Software," http://zeligproject.org/</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(z.out1)</code></pre></div>
<pre><code>## Model: 
## 
## Call:
## z5$zelig(formula = log(packs) ~ log_rprice + log_rincome | log_rincome + 
##     tdiff + I(tax/cpi), data = CigarettesSW, subset = year == 
##     "1995")
## 
## Residuals:
##        Min         1Q     Median         3Q        Max 
## -0.6006931 -0.0862222 -0.0009999  0.1164699  0.3734227 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)   9.8950     1.0586   9.348 4.12e-12
## log_rprice   -1.2774     0.2632  -4.853 1.50e-05
## log_rincome   0.2804     0.2386   1.175    0.246
## 
## Residual standard error: 0.1879 on 45 degrees of freedom
## Multiple R-Squared: 0.4294,  Adjusted R-squared: 0.4041 
## Wald test: 13.28 on 2 and 45 DF,  p-value: 2.931e-05 
## 
## Next step: Use 'setx' method</code></pre>
<p>We can then simulate and plot the expected value of the log of the <code>packs</code> response variable across the range of the observed <code>rprice</code> regressor values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z.out1 %&gt;%<span class="st"> </span><span class="kw"><a href="../reference/setx.html">setx</a></span>(<span class="dt">log_rprice =</span> <span class="kw">range</span>(<span class="kw">log</span>(CigarettesSW$rprice))) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/sim.html">sim</a></span>() %&gt;%
<span class="st">    </span><span class="kw">plot</span>()</code></pre></div>
<p><img src="zelig_ivreg_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>To conduct standard diagnostic tests on the estimated model using functionality in the <a href="https://CRAN.R-project.org/package=AER">AER</a> package, exatract the fitted model object with the <code><a href="../reference/from_zelig_model.html">from_zelig_model()</a></code> function.</p>
</div>
<div id="model-definition" class="section level2">
<h2 class="hasAnchor">
<a href="#model-definition" class="anchor"></a>Model Definition</h2>
<p><em>One stage (ordinary) least squares</em> is given by:</p>
<ul>
<li>The <em>stochastic component</em> which is described by a density with mean <span class="math inline">\(\mu_i\)</span> and the common variance <span class="math inline">\(\sigma^2\)</span>
</li>
</ul>
<p><span class="math display">\[
    Y_i \; \sim \; f(y_i \mid \mu_i, \sigma^2).
\]</span></p>
<ul>
<li>The <em>systematic component</em> modelling the conditional mean as</li>
</ul>
<p><span class="math display">\[
   \mu_i =  x_i \beta,
\]</span></p>
<p>where <span class="math inline">\(x_i\)</span> is the vector of covariates, and <span class="math inline">\(\beta\)</span> is the vector of coefficients.</p>
<p>The least squares estimator is the best linear predictor of a dependent variable given <span class="math inline">\(x_i\)</span>, and minimizes the sum of squared residuals, <span class="math inline">\(\sum_{i=1}^n (Y_i-x_i \beta)^2\)</span>.</p>
<p>In <em>two-stage least squares</em> uses these components twice to uncover the effect of the endogenous variables on the continuous dependent variable.</p>
<p>In the first stage, each endogenous variable is estimated with least squares regressions that include all of the exogenous variables (the instruments and any other exogenous variables used to estimate the dependent variable). The predicted values of the endogenous variables from these models (and the exogenous, non-instrumental variables) are then used in the second stage regression.</p>
</div>
<div id="quantities-of-interest-definition" class="section level2">
<h2 class="hasAnchor">
<a href="#quantities-of-interest-definition" class="anchor"></a>Quantities of Interest Definition</h2>
<ul>
<li>The expected value (<code>qi$ev</code>) is the mean of simulations from the stochastic component of the <em>second stage</em>,</li>
</ul>
<p><span class="math display">\[
    E(Y) = x_i \beta,
\]</span></p>
<p>given a draw of <span class="math inline">\(\beta\)</span> from its sampling distribution.</p>
<ul>
<li>In conditional prediction models, the average expected treatment effect (<code>att.ev</code>) for the treatment group is</li>
</ul>
<p><span class="math display">\[
    \frac{1}{\sum_{i=1}^n t_i}\sum_{i:t_i=1}^n \left\{ Y_i(t_i=1) -
            E[Y_i(t_i=0)] \right\},
\]</span></p>
<p>where <span class="math inline">\(t_i\)</span> is a binary explanatory variable defining the treatment (<span class="math inline">\(t_i=1\)</span>) and control (<span class="math inline">\(t_i=0\)</span>) groups. Variation in the simulations are due to uncertainty in simulating <span class="math inline">\(E[Y_i(t_i=0)]\)</span>, the counterfactual expected value of <span class="math inline">\(Y_i\)</span> for observations in the treatment group, under the assumption that everything stays the same except that the treatment indicator is switched to :math: <span class="math inline">\(t_i=0\)</span>.</p>
</div>
<div id="see-also" class="section level2">
<h2 class="hasAnchor">
<a href="#see-also" class="anchor"></a>See also</h2>
<p><code>ivreg</code> is from Christian Kleiber and Achim Zeileis (2008). Applied Econometrics with R. New York: Springer-Verlag. ISBN 978-0-387-77316-2. URL <a href="https://CRAN.R-project.org/package=AER" class="uri">https://CRAN.R-project.org/package=AER</a>. For more information use <code>?AER::ivreg</code>.</p>
<p>Greene, W. H. (1993) Econometric Analysis, 2nd ed., Macmillan.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#syntax">Syntax</a></li>
      <li><a href="#examples">Examples</a></li>
      <li><a href="#model-definition">Model Definition</a></li>
      <li><a href="#quantities-of-interest-definition">Quantities of Interest Definition</a></li>
      <li><a href="#see-also">See also</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Christine Choirat, Christopher Gandrud, James Honaker, Kosuke Imai, Gary King, Olivia Lau.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
