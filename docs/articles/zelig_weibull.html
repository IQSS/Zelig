<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weibull • Zelig</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">Zelig Project</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/quickstart.html">Quickstart</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/index.html#section-zelig-overview">Zelig Overview</a>
    </li>
    <li>
      <a href="../articles/index.html#section-core-zelig-model-details">Zelig Model Details</a>
    </li>
    <li>
      <a href="../articles/index.html#section-other">Other</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Function Reference
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html#section-main-zelig-workflow">Workflow</a>
    </li>
    <li>
      <a href="../reference/index.html#section-estimation-methods">Estimation Methods</a>
    </li>
    <li>
      <a href="../reference/index.html#section-exterior-interaction-functions">Interacting Outside of Zelig</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    About
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/about.html">Contact/Development Team/Citation</a>
    </li>
    <li>
      <a href="../articles/roadmap.html">Development Roadmap</a>
    </li>
    <li>
      <a href="https://iqss.github.io/rpackagemetrics/">Zelig Adoption Metrics</a>
    </li>
    <li>
      <a href="https://raw.githubusercontent.com/IQSS/Zelig/master/.iqss_reportcard.yml">Statistical Software Devepment Reportcard</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://medium.com/zelig-dev/archive">
    <span class="fa fa-medium"></span>
     
    Dev-Blog
  </a>
</li>
<li>
  <a href="https://twitter.com/zeligproject">
    <span class="fa fa-twitter fa-2x"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/IQSS/Zelig">
    <span class="fa fa-github fa-2x"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Weibull</h1>
            
            <h4 class="date">2017-05-16</h4>
          </div>

    
    
<div class="contents">
<p><em>Built using Zelig version 5.1.1.90000</em></p>
<hr>
<p>Weibull Regression for Duration Dependent Variables with <code>weibull</code>.</p>
<p>Choose the Weibull regression model if the values in your dependent variable are duration observations. The Weibull model relaxes the exponential model’s assumption of constant hazard, and allows the hazard rate to increase or decrease monotonically with respect to elapsed time.</p>
<div id="syntax" class="section level2">
<h2 class="hasAnchor">
<a href="#syntax" class="anchor"></a>Syntax</h2>
<p>With reference classes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z5 &lt;-<span class="st"> </span>zweibull<span class="op">$</span><span class="kw">new</span>()
z5<span class="op">$</span><span class="kw"><a href="../reference/zelig.html">zelig</a></span>(<span class="kw">Surv</span>(Y, C) <span class="op">~</span><span class="st"> </span>X, <span class="dt">weights =</span> w, <span class="dt">data =</span> mydata)
z5<span class="op">$</span><span class="kw"><a href="../reference/setx.html">setx</a></span>()
z5<span class="op">$</span><span class="kw"><a href="../reference/sim.html">sim</a></span>()</code></pre></div>
<p>With the Zelig 4 compatibility wrappers:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z.out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/zelig.html">zelig</a></span>(<span class="kw">Surv</span>(Y, C) <span class="op">~</span><span class="st"> </span>X, <span class="dt">model =</span> <span class="st">"weibull"</span>, <span class="dt">weights =</span> w,
               <span class="dt">data =</span> mydata)
x.out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/setx.html">setx</a></span>(z.out)
s.out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim.html">sim</a></span>(z.out, <span class="dt">x =</span> x.out)</code></pre></div>
<p>Weibull models require that the dependent variable be in the form Surv(Y, C), where Y and C are vectors of length <span class="math inline">\(n\)</span>. For each observation <span class="math inline">\(i\)</span> in 1, …, <span class="math inline">\(n\)</span>, the value <span class="math inline">\(y_i\)</span> is the duration (lifetime, for example), and the associated <span class="math inline">\(c_i\)</span> is a binary variable such that <span class="math inline">\(c_i = 1\)</span> if the duration is not censored (<em>e.g.</em>, the subject dies during the study) or <span class="math inline">\(c_i = 0\)</span> if the duration is censored (<em>e.g.</em>, the subject is still alive at the end of the study). If <span class="math inline">\(c_i\)</span> is omitted, all Y are assumed to be completed; that is, time defaults to 1 for all observations.</p>
</div>
<div id="input-values" class="section level2">
<h2 class="hasAnchor">
<a href="#input-values" class="anchor"></a>Input Values</h2>
<p>In addition to the standard inputs, zelig() takes the following additional options for weibull regression:</p>
<ul>
<li><p>robust: defaults to FALSE. If TRUE, zelig() computes robust standard errors based on sandwich estimators (see and ) based on the options in cluster.</p></li>
<li><p>cluster: if robust = TRUE, you may select a variable to define groups of correlated observations. Let x3 be a variable that consists of either discrete numeric values, character strings, or factors that define strata. Then</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z.out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/zelig.html">zelig</a></span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">robust =</span> <span class="ot">TRUE</span>, <span class="dt">cluster =</span> <span class="st">"x3"</span>,
               <span class="dt">model =</span> <span class="st">"exp"</span>, <span class="dt">data =</span> mydata)</code></pre></div>
<p>means that the observations can be correlated within the strata defined by the variable x3, and that robust standard errors should be calculated according to those clusters. If <span class="math inline">\(robust = TRUE\)</span> but cluster is not specified, zelig() assumes that each observation falls into its own cluster.</p>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>Attach the sample data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(coalition)</code></pre></div>
<p>Estimate the model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z.out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/zelig.html">zelig</a></span>(<span class="kw">Surv</span>(duration, ciep12) <span class="op">~</span><span class="st"> </span>fract <span class="op">+</span><span class="st"> </span>numst2,
               <span class="dt">model =</span> <span class="st">"weibull"</span>, <span class="dt">data =</span> coalition)</code></pre></div>
<pre><code>## How to cite this model in Zelig:
##   Terry M Therneau, and Thomas Lumley. 2007.
##   weibull: Weibull Regression for Duration Dependent Variables
##   in Christine Choirat, Christopher Gandrud, James Honaker, Kosuke Imai, Gary King, and Olivia Lau,
##   "Zelig: Everyone's Statistical Software," http://zeligproject.org/</code></pre>
<p>View the regression output:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(z.out)</code></pre></div>
<pre><code>## Model: 
## 
## Call:
## z5$zelig(formula = Surv(duration, ciep12) ~ fract + numst2, data = coalition)
##                Value Std. Error      z        p
## (Intercept)  5.49850   0.525646 10.460 1.31e-25
## fract       -0.00384   0.000714 -5.374 7.69e-08
## numst2       0.45232   0.118924  3.803 1.43e-04
## Log(scale)  -0.04435   0.049987 -0.887 3.75e-01
## 
## Scale= 0.957 
## 
## Weibull distribution
## Loglik(model)= -1077   Loglik(intercept only)= -1100.6
##  Chisq= 47.18 on 2 degrees of freedom, p= 5.7e-11 
## Number of Newton-Raphson Iterations: 5 
## n= 314 
## 
## Next step: Use 'setx' method</code></pre>
<p>Set the baseline values (with the ruling coalition in the minority) and the alternative values (with the ruling coalition in the majority) for X:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x.low &lt;-<span class="st"> </span><span class="kw"><a href="../reference/setx.html">setx</a></span>(z.out, <span class="dt">numst2 =</span> <span class="dv">0</span>)
x.high &lt;-<span class="st"> </span><span class="kw"><a href="../reference/setx.html">setx</a></span>(z.out, <span class="dt">numst2 =</span> <span class="dv">1</span>)</code></pre></div>
<p>Simulate expected values and first differences:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s.out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sim.html">sim</a></span>(z.out, <span class="dt">x =</span> x.low, <span class="dt">x1 =</span> x.high)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(s.out)</code></pre></div>
<pre><code>## 
##  sim x :
##  -----
## ev
##       mean       sd      50%     2.5%    97.5%
## 1 15.27579 1.401267 15.23677 12.75938 18.12979
## pv
##          mean       sd      50%      2.5%    97.5%
## [1,] 15.10834 14.40472 11.24056 0.5767899 54.05405
## 
##  sim x1 :
##  -----
## ev
##       mean       sd      50%     2.5%    97.5%
## 1 23.95177 1.805729 23.93098 20.51706 27.74208
## pv
##          mean       sd      50%     2.5%   97.5%
## [1,] 23.79848 21.39514 17.55209 1.032722 77.9025
## fd
##       mean       sd     50%     2.5%    97.5%
## 1 8.675973 2.265219 8.63897 4.462617 13.20894</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(s.out)</code></pre></div>
<div class="figure">
<img src="zelig_weibull_files/figure-html/Zelig-weibull-1.png" alt="Graphs of Quantities of Interest for Zelig-weibull" width="672"><p class="caption">
Graphs of Quantities of Interest for Zelig-weibull
</p>
</div>
</div>
<div id="model" class="section level2">
<h2 class="hasAnchor">
<a href="#model" class="anchor"></a>Model</h2>
<p>Let <span class="math inline">\(Y_i^*\)</span> be the survival time for observation <span class="math inline">\(i\)</span>. This variable might be censored for some observations at a fixed time <span class="math inline">\(y_c\)</span> such that the fully observed dependent variable, <span class="math inline">\(Y_i\)</span>, is defined as</p>
<p><span class="math display">\[
    Y_i = \left\{ \begin{array}{ll}
        Y_i^* &amp; \textrm{if }Y_i^* \leq y_c \\
         y_c &amp; \textrm{if }Y_i^* &gt; y_c
       \end{array} \right.
\]</span></p>
<ul>
<li>The <em>stochastic component</em> is described by the distribution of the partially observed variable <span class="math inline">\(Y^*\)</span>. We assume <span class="math inline">\(Y_i^*\)</span> follows the Weibull distribution whose density function is given by</li>
</ul>
<p><span class="math display">\[
    f(y_i^*\mid \lambda_i, \alpha) = \frac{\alpha}{\lambda_i^\alpha}
        y_i^{* \alpha-1} \exp \left\{ -\left( \frac{y_i^*}{\lambda_i}
      \right)^{\alpha} \right\}
\]</span></p>
<p>for <span class="math inline">\(y_i^* \ge 0\)</span>, the scale parameter <span class="math inline">\(\lambda_i &gt; 0\)</span>, and the shape parameter <span class="math inline">\(\alpha &gt; 0\)</span>. The mean of this distribution is <span class="math inline">\(\lambda_i \Gamma(1 + 1 / \alpha)\)</span>. When <span class="math inline">\(\alpha = 1\)</span>, the distribution reduces to the exponential distribution (see Section [exp]). (Note that the output from zelig() parameterizes scale $ = 1 / $.)</p>
<p>In addition, survival models like the Weibull have three additional properties. The hazard function <span class="math inline">\(h(t)\)</span> measures the probability of not surviving past time <span class="math inline">\(t\)</span> given survival up to <span class="math inline">\(t\)</span>. In general, the hazard function is equal to <span class="math inline">\(f(t)/S(t)\)</span> where the survival function <span class="math inline">\(S(t) = 1 - \int_{0}^t f(s) ds\)</span> represents the fraction still surviving at time <span class="math inline">\(t\)</span>. The cumulative hazard function <span class="math inline">\(H(t)\)</span> describes the probability of dying before time <span class="math inline">\(t\)</span>. In general, <span class="math inline">\(H(t)= \int_{0}^{t} h(s) ds = -\log S(t)\)</span>. In the case of the Weibull model,</p>
<p><span class="math display">\[
    \begin{aligned}
        h(t) &amp;=&amp; \frac{\alpha}{\lambda_i^{\alpha}} t^{\alpha - 1}  \\
      S(t) &amp;=&amp;  \exp \left\{ -\left( \frac{t}{\lambda_i} \right)^{\alpha} \right\} \\
      H(t) &amp;=&amp; \left( \frac{t}{\lambda_i} \right)^{\alpha}
    \end{aligned}
\]</span> For the Weibull model, the hazard function <span class="math inline">\(h(t)\)</span> can increase or decrease monotonically over time.</p>
<ul>
<li>The <em>systematic component</em> <span class="math inline">\(\lambda_i\)</span> is modeled as</li>
</ul>
<p><span class="math display">\[
    \lambda_i = \exp(x_i \beta),
\]</span></p>
<p>where <span class="math inline">\(x_i\)</span> is the vector of explanatory variables, and <span class="math inline">\(\beta\)</span> is the vector of coefficients.</p>
</div>
<div id="quantities-of-interest" class="section level2">
<h2 class="hasAnchor">
<a href="#quantities-of-interest" class="anchor"></a>Quantities of Interest</h2>
<ul>
<li>The expected values (qi$ev) for the Weibull model are simulations of the expected duration:</li>
</ul>
<p><span class="math display">\[
    E(Y) = \lambda_i \, \Gamma (1 + \alpha^{-1}),
\]</span></p>
<p>given draws of <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\alpha\)</span> from their sampling distributions.</p>
<ul>
<li><p>The predicted value (qi$pr) is drawn from a distribution defined by <span class="math inline">\((\lambda_i, \alpha)\)</span>.</p></li>
<li><p>The first difference (qi$fd) in expected value is</p></li>
</ul>
<p><span class="math display">\[
    \textrm{FD} = E(Y \mid x_1) - E(Y \mid x).
\]</span></p>
<ul>
<li>In conditional prediction models, the average expected treatment effect (att.ev) for the treatment group is</li>
</ul>
<p><span class="math display">\[
    \frac{1}{\sum_{i=1}^n t_i}\sum_{i:t_i=1}^n \left\{ Y_i(t_i=1) -
        E[Y_i(t_i=0)] \right\},
\]</span></p>
<p>where <span class="math inline">\(t_i\)</span> is a binary explanatory variable defining the treatment (<span class="math inline">\(t_i=1\)</span>) and control (<span class="math inline">\(t_i=0\)</span>) groups. When <span class="math inline">\(Y_i(t_i=1)\)</span> is censored rather than observed, we replace it with a simulation from the model given available knowledge of the censoring process. Variation in the simulations are due to uncertainty in simulating <span class="math inline">\(E[Y_i(t_i=0)]\)</span>, the counterfactual expected value of <span class="math inline">\(Y_i\)</span> for observations in the treatment group, under the assumption that everything stays the same except that the treatment indicator is switched to <span class="math inline">\(t_i=0\)</span>.</p>
<ul>
<li>In conditional prediction models, the average predicted treatment effect (att.pr) for the treatment group is</li>
</ul>
<p><span class="math display">\[
    \frac{1}{\sum_{i=1}^n t_i}\sum_{i:t_i=1}^n \left\{ Y_i(t_i=1) -
        \widehat{Y_i(t_i=0)} \right\},
\]</span></p>
<p>where <span class="math inline">\(t_i\)</span> is a binary explanatory variable defining the treatment (<span class="math inline">\(t_i=1\)</span>) and control (<span class="math inline">\(t_i=0\)</span>) groups. When <span class="math inline">\(Y_i(t_i=1)\)</span> is censored rather than observed, we replace it with a simulation from the model given available knowledge of the censoring process. Variation in the simulations are due to uncertainty in simulating <span class="math inline">\(\widehat{Y_i(t_i=0)}\)</span>, the counterfactual predicted value of <span class="math inline">\(Y_i\)</span> for observations in the treatment group, under the assumption that everything stays the same except that the treatment indicator is switched to <span class="math inline">\(t_i=0\)</span>.</p>
</div>
<div id="output-values" class="section level2">
<h2 class="hasAnchor">
<a href="#output-values" class="anchor"></a>Output Values</h2>
<p>The Zelig object stores fields containing everything needed to rerun the Zelig output, and all the results and simulations as they are generated. In addition to the summary commands demonstrated above, some simply utility functions (known as <em>getters</em>) provide easy access to the raw fields most commonly of use for further investigation.</p>
<p>In the example above <code>z.out$get_coef()</code> returns the estimated coefficients, <code>z.out$get_vcov()</code> returns the estimated covariance matrix, and <code>z.out$get_predict()</code> provides predicted values for all observations in the dataset from the analysis.</p>
</div>
<div id="see-also" class="section level2">
<h2 class="hasAnchor">
<a href="#see-also" class="anchor"></a>See also</h2>
<p>The Weibull model is part of the survival library by Terry Therneau, ported to R by Thomas Lumley. Advanced users may wish to refer to <code>help(survfit)</code> in the survival library.</p>
<p>Therneau T (2015). <em>A Package for Survival Analysis in S</em>. version 2.38, &lt;URL: <a href="https://CRAN.R-project.org/package=survival" class="uri">https://CRAN.R-project.org/package=survival</a>&gt;.</p>
<p>Terry M. Therneau and Patricia M. Grambsch (2000). <em>Modeling Survival Data: Extending the Cox Model</em>. Springer, New York. ISBN 0-387-98784-3.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#syntax">Syntax</a></li>
      <li><a href="#input-values">Input Values</a></li>
      <li><a href="#example">Example</a></li>
      <li><a href="#model">Model</a></li>
      <li><a href="#quantities-of-interest">Quantities of Interest</a></li>
      <li><a href="#output-values">Output Values</a></li>
      <li><a href="#see-also">See also</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Christine Choirat, Christopher Gandrud, James Honaker, Kosuke Imai, Gary King, Olivia Lau.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
